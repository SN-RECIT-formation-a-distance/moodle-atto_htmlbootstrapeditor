YUI.add("moodle-atto_htmlbootstrapeditor-button",function(t,e){t.namespace("M.atto_htmlbootstrapeditor").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({title:"htmleditor",icon:"html",iconComponent:"atto_htmlbootstrapeditor",callback:this.openHtmlEditor,buttonName:"htmleditor"})},globalVars:{popup:null},openHtmlEditor:function(t){var a;t.preventDefault(),null===this.globalVars.popup||this.globalVars.popup.closed?(a=this,t=M.cfg.wwwroot,t+="/admin/tool/htmlbootstrapeditor/view.php",this.globalVars.popup=window.open(t,"HTML Bootstrap Editor","scrollbars=1"),this.globalVars.popup.IWrapper=M.recit.htmlbootstrapeditor.IWrapper,this.globalVars.popup.IWrapper.uploadFile=function(t,e,o){var i=a.getFileTransferData();let r=new XMLHttpRequest;r.onreadystatechange=()=>o(r);let p=new FormData;p.append("repo_upload_file",e),p.append("itemid",i.itemid),p.append("env",i.env),p.append("repo_id",i.repo_id),p.append("sesskey",M.cfg.sesskey),p.append("client_id",i.client_id),p.append("savepath","/"),p.append("ctx_id",M.cfg.contextid),p.append("license",i.license),p.append("author",i.author);i=t.split(".");t=[i[0]||"",i[1]||""],p.append("title",`${t[0].substr(0,255)}.${t[1]}`),r.open("POST",M.cfg.wwwroot+"/repository/repository_ajax.php?action=upload",!0),r.send(p)},M.recit.htmlbootstrapeditor.IWrapper.getContent=function(){return a.editor.getHTML()},M.recit.htmlbootstrapeditor.IWrapper.setContent=function(t){a.editor.setHTML(t),a.globalVars.popup.close()},M.recit.htmlbootstrapeditor.IWrapper.get_string=function(t,e){if("undefined"==typeof M)return t;let o=M||window.parent.M;return o.util.get_string(t,"tool_htmlbootstrapeditor")},this.getFileTransferData=function(){var t,e=a.get("host"),o=e.get("filepickeroptions").image||{},i={repo_id:0};for(t in i.client_id=o.client_id||0,i.env=o.env||"",i.license=o.defaultlicense||"",i.itemid=o.itemid||0,i.author=o.author||"",t="",o.repositories)if("upload"===o.repositories[t].type){i.repo_id=o.repositories[t].id;break}for(t in o.licenses)if("cc"===o.licenses[t].shortname){i.license=o.licenses[t].shortname;break}return i}):this.globalVars.popup.focus()}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});