YUI.add("moodle-atto_htmlbootstrapeditor-button",function(t,e){t.namespace("M.atto_htmlbootstrapeditor").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({title:"htmleditor",icon:"html",iconComponent:"atto_htmlbootstrapeditor",callback:this.openHtmlEditor,buttonName:"htmleditor"})},globalVars:{popup:null},openHtmlEditor:function(t){var a;t.preventDefault(),null===this.globalVars.popup||this.globalVars.popup.closed?(a=this,t=M.cfg.wwwroot,t+="/admin/tool/htmlbootstrapeditor/view.php",this.globalVars.popup=window.open(t,"HTML Bootstrap Editor","scrollbars=1"),this.globalVars.popup.IWrapper=M.recit.htmlbootstrapeditor.IWrapper,this.globalVars.popup.IWrapper.uploadFile=function(t,e,o){var r=a.getFileTransferData();let i=new XMLHttpRequest;i.onreadystatechange=()=>{if(4===i.readyState)if(200===i.status){var e=JSON.parse(i.responseText);if(e)if(e.error)console.log(e);else{let t=e;e.event&&"fileexists"===e.event&&(t=e.newfile),o(t)}}else alert("server error")};let p=new FormData;p.append("repo_upload_file",e),p.append("itemid",r.itemid),p.append("env",r.env),p.append("repo_id",r.repo_id),p.append("sesskey",M.cfg.sesskey),p.append("client_id",r.client_id),p.append("savepath","/"),p.append("ctx_id",M.cfg.contextid),p.append("license",r.license),p.append("author",r.author);r=t.split(".");t=[r[0]||"",r[1]||""],p.append("title",`${t[0].substr(0,255)}.${t[1]}`),i.open("POST",M.cfg.wwwroot+"/repository/repository_ajax.php?action=upload",!0),i.send(p)},M.recit.htmlbootstrapeditor.IWrapper.getContent=function(){return a.editor.getHTML()},M.recit.htmlbootstrapeditor.IWrapper.setContent=function(t){a.editor.setHTML(t),a.globalVars.popup.close()},M.recit.htmlbootstrapeditor.IWrapper.get_string=function(t,e){if("undefined"==typeof M)return t;let o=M||window.parent.M;return o.util.get_string(t,"tool_htmlbootstrapeditor")},this.getFileTransferData=function(){var t,e=a.get("host"),o=e.get("filepickeroptions").image||{},r={repo_id:0};for(t in r.client_id=o.client_id||0,r.env=o.env||"",r.license=o.defaultlicense||"",r.itemid=o.itemid||0,r.author=o.author||"",t="",o.repositories)if("upload"===o.repositories[t].type){r.repo_id=o.repositories[t].id;break}for(t in o.licenses)if("cc"===o.licenses[t].shortname){r.license=o.licenses[t].shortname;break}return r}):this.globalVars.popup.focus()}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});